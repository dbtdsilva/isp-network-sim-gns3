\documentclass[11pt,a4paper]{report}
\usepackage[english]{babel}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{glossaries}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{wrapfig}
\usepackage{float}
\usepackage{natbib}
\usepackage{listings}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{color}
 
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}
\newcommand{\HRule}{\rule{\linewidth}{0.5mm}}
\setlength\parindent{0pt} % Removes all indentation from paragraphs	 
%% Acronimos
%\newglossaryentry{sqlite}
%{
%  name=SQLite,
%  description={é um sistema de gestão de base de dados}
%}
%\newacronym{aes}{AES}{Advanced Encryption Standard}
%\newacronym{sha}{SHA}{Secure Hash Algorithm}
%\makeglossaries
%% Fim da introdução do Acronimos

\let\olditemize\itemize
\renewcommand{\itemize}{
  \olditemize
  \setlength{\itemsep}{1pt}
  \setlength{\parskip}{0pt}
  \setlength{\parsep}{0pt}
}

\title{\textbf{Internet Service Provider ARA Project} \\Arquitectura de Redes Avançada \\Universidade de Aveiro}
\author{Diogo Silva 60337 \and Eduardo Sousa 68633 }

\begin{document}
\begin{titlepage}
\begin{center}
\HRule \\[0.4cm]
{ \huge \bfseries Internet Service Provider ARA Project \\[0.4cm] }
\HRule \\[1.5cm]
\textsc{\LARGE Universidade de Aveiro}\\[1.5cm]
\textsc{}\\[1.5cm]
\textsc{Diogo Silva 60337 \\Eduardo 68633 }
\end{center}
\end{titlepage}
\maketitle
\tableofcontents

\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},   
    commentstyle=\color{codegreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\footnotesize,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                 
    numbers=left,                    
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=2
}
\lstset{style=mystyle}

\chapter{Basic Mechanisms and BGP}

\section{Internal BGP \& OSPF Redistribution}
\#EDUARDO
\section{External BGP}
\#EDUARDO
\section{Private AS}
\#EDUARDO

\section{Routing Constraints}

Neste projecto todas as restrições de routing apresentadas a seguir foram efectuadas usando route-map para efectuar a respectiva regra, ou negar a rota, ou aumentar a local preference da rede anunciada no iBGP.

\subsection{Internet Traffic}

``IP traffic towards Internet should be preferably routed via ISP S (Lisboa).''
\newline

Se a rota pertence à internet incrementa-se a preferência local (podia-se ter usado 0.0.0.0 para representar qualquer outra rede externa, ou seja, internet). No trecho de código seguinte podemos ver que se o ip da internet se verificar, coloca uma preferência local acima da default, caso não seja, anuncia a rota como veio.

\begin{lstlisting}[caption=Route-map para a Internet]
access-list 5 permit 8.8.8.0 0.0.0.255

route-map INTERNET_LP permit 10
 match ip address 5
 set local-preference 200

route-map INTERNET_LP permit 20
\end{lstlisting}

Como se pretende dar mais preferência à ligação entre Sintra e Lisboa quando o tráfico vai para a internet, aplica-se o route-map a todas as rotas anunciadas por Sintra a Lisboa, sendo que se alguma dessas rotas anunciadas por Sintra pertencer a internet, a preferência local será aumentada.\\

\begin{lstlisting}[caption=Route-map da Internet no Neighbor Sintra no Router de Lisboa]
router bgp 9.345
 address-family ipv4
  ...
  neighbor 4.20.20.13 route-map INTERNET_LP in
\end{lstlisting}

\subsection{Net L1 and Net L2 Preferences}

``IP traffic towards netL1 and netL2, should be preferably routed via Porto from Aveiro, and via Lisboa from Faro.''
\newline

Definiu-se a seguinte route-map em Aveiro e Faro, tendo em conta que ambos querem aumentar a preferência para a route-map na netL1 e netL2, a única diferença é por onde querer ir (só muda onde é aplicada a route-map), então definiu-se a mesma para os dois.

\begin{lstlisting}[caption=Route-map para a netL1 e netL2]
access-list 10 permit 82.84.100.0 0.0.0.255
access-list 10 permit 82.84.200.0 0.0.0.255

route-map LNET_LP permit 25
 match ip address 10
 set local-preference 210
route-map LNET_LP permit 30
\end{lstlisting}

Depois de definida a route-map, aplicou-se a rota ao neighbor respectivo.

Se Aveiro receber uma rota anunciada pelo Porto que cumpra a route-map, aumenta-lhe a perferência. Em Faro caso receba uma rota anunciada por Lisboa que cumpra a route-map, aumenta-lhe a preferência local.

Isso fez-se através do seguinte código.\\
\begin{lstlisting}[caption=Route-map LNET\_LP no Neighbor Porto no Router de Aveiro]
  neighbor 192.172.100.1 route-map LNET_LP in
\end{lstlisting}

\begin{lstlisting}[caption=Route-map LNET\_LP no Neighbor Lisboa no Router de Faro]
  neighbor 192.172.100.2 route-map LNET_LP in
\end{lstlisting}

\subsection{SIP Proxy 2 Traffic}

``IP traffic for remote SIP proxy 2 (to network netS1) should be routed only via Lisboa using the direct peering link to ISP S.''
\newline

Para fazer com que Lisboa -> Sintra fosse o único peering possível do ISP X para a NetS1, optou-se pela estratégia oposta, negar todas as saídas possíveis, ou seja, tudo o que anunciar a NetS1 e que não seja aquele link não é aceite. Sendo definida a seguinte rota:\\

\begin{lstlisting}[caption=Route-map SIP\_ROUTE para cancelar rotas]
access-list 6 permit 200.1.100.0 0.0.0.255

route-map SIP_ROUTE deny 11
 match ip address 6
route-map SIP_ROUTE permit 21
\end{lstlisting}

Sendo que foi preciso definir nos neighbors as rotas, neste caso, em Lisboa e Porto, rotas para a NetS1 recebidas pelo link de London.\\

\begin{lstlisting}[caption=Cancelar rota para NetS1 recebida em Lisboa por London]
neighbor 4.20.20.5 route-map SIP_ROUTE in
\end{lstlisting}

\begin{lstlisting}[caption=Cancelar rota para NetS1 recebida no Porto por London]
neighbor 4.20.20.1 route-map SIP_ROUTE in
\end{lstlisting}

\subsection{Non-Transit ISP-X}

Para efectuar o Non-Transit foi preciso definir uma verificação no as-path, se o AS-PATH for vazio, ou contiver apenas o AS 65000 (privado) significa que é uma rota interna e pode ser anunciada para que os outros saibam que aquele neighbor pode ser usado para chegar a rede anunciada, sendo que redes que contenham outros AS-PATH (Sistemas autonomos externos não serão anunciados para fora).\\

Teve-se de verificar para o AS 65000 porque ele atravessa pelo AS 9.345 para sair para London ou Sintra, e o rm-private-as é apenas retirado depois da validação das route-maps definidas no neighbor.\\

Sendo que se usou a seguinte route-map em todas as saídas possíveis do AS 9.345:

\begin{lstlisting}[caption=Tornar ISP X num AS Non-Transit]
ip as-path access-list 4 permit ^$
ip as-path access-list 4 permit ^65000$
route-map NON_TRANSIT permit 10
 match as-path 4
\end{lstlisting}

Sendo depois aplica-se esta route-map em Lisboa e no Porto em todos os neighbors ao anunciar rotas para fora (neighbor VIZINHO route-map NON\_TRANSIT out)

\section{Changes for IPv6}
\#EDUARDO

\chapter{MPLS}
\#DIOGO
\section{MPLS Tunnel for SIP Traffic}
\section{MPLS VPN}


\chapter{VoIP SIP}
\#EDUARDO
\section{Internal Extensions}
\section{PTSN Calls Support}
\section{Forward to SIP Proxy 2}


\lstlistoflistings
\bibliographystyle{plain}
\bibliography{proj2}

\end{document}
